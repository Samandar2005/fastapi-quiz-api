## Quiz API (FastAPI + Tortoise ORM)

A minimal REST API for quizzes with JWT authentication. Built with FastAPI and Tortoise ORM, backed by PostgreSQL.

### Tech Stack
- **FastAPI** for the web framework
- **Tortoise ORM** with **PostgreSQL**
- **JWT** auth via `python-jose`
- **passlib[bcrypt]** for password hashing

### What does this project do?
- **Authenticates users via JWT** (`/auth/token`).
- Allows **creating questions** and **listing questions** (`/quiz/questions/`).
- Persists answers related to questions at the model level.
- All quiz endpoints are protected and require `Bearer <token>`.

### Key features
- **Quick start**: automatic schema generation (Tortoise `generate_schemas=True`).
- **Modular architecture**: separate auth and quiz routers.
- **Type safety**: request/response validation with Pydantic schemas.
- **Standard OAuth2 password flow** with `Authorization: Bearer <JWT>`.

### Project Structure
```text
quiz_api/
  auth.py        # Auth router: token issuance + current user dependency
  quiz.py        # Quiz router: create/list questions (auth required)
  models.py      # Tortoise models: User, Question, Answer, UserAnswer, QuizResult
  schemas.py     # Pydantic schemas for request/response models
  config.py      # Configuration (DATABASE_URL, JWT config)
  main.py        # FastAPI app, router registration, Tortoise init
  requirements.txt
```

### How it works (short flow)
1) Client sends `username/password` to `POST /auth/token`.
2) Server validates the user and issues a **JWT**.
3) Client calls protected endpoints with `Authorization: Bearer <JWT>`.
4) Creating and fetching questions are handled by the quiz router.

### Requirements
See `requirements.txt`. Create and activate a virtualenv, then:

```bash
pip install -r requirements.txt
```

### Configuration
Environment variables (via `.env` or system env):
- `DATABASE_URL` (default: `postgres://postgres:1234@localhost:5432/quiz_db`)
- `SECRET_KEY` (default: `change-me-in-.env`)
- `ALGORITHM` (default: `HS256`)
- `ACCESS_TOKEN_EXPIRE_MINUTES` (default: `30`)

Example `.env`:
```env
DATABASE_URL=postgres://postgres:password@localhost:5432/quiz_db
SECRET_KEY=your-very-secret-key
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=60
```

### Database
Tortoise will auto-generate schemas on startup (`generate_schemas=True`). Ensure the target database exists and is reachable by `DATABASE_URL`.

Models (see `models.py`):
- `User(username, email, hashed_password, is_active)`
- `Question(text, category, difficulty, created_at)`
- `Answer(question -> Question, text, is_correct)`
- `UserAnswer(user, question, answer, answered_at)`
- `QuizResult(user, total_questions, correct_answers, completed_at)`

### Running
Development server:
```bash
uvicorn main:app --reload
```

The API will be available at `http://127.0.0.1:8000`. Interactive docs:
- Swagger UI: `http://127.0.0.1:8000/docs`
- ReDoc: `http://127.0.0.1:8000/redoc`

### Authentication
OAuth2 Password flow with bearer tokens.

Token endpoint:
- `POST /auth/token` (form data: `username`, `password`)

The app expects users to exist in the `User` table with `hashed_password` generated by bcrypt. You may seed users manually for development.

Create the first user (development):
- Option A (generate a hash only):
  ```bash
  python -c "from passlib.context import CryptContext; print(CryptContext(schemes=['bcrypt']).hash('secret'))"
  ```
  Then insert a user into the `User` table with the generated hash (via your DB client).

- Option B (small ORM script): initialize Tortoise and create a user using the `User` model.

Example (cURL):
```bash
curl -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=alice&password=secret" \
  http://127.0.0.1:8000/auth/token
```

Response:
```json
{"access_token":"<JWT>","token_type":"bearer"}
```

Use the token with `Authorization: Bearer <JWT>` for protected endpoints.

### Quiz Endpoints
Prefix: `/quiz`

- `POST /quiz/questions/` — Create a question (auth required)
  - Body (JSON): `{ "text": "...", "category": "...", "difficulty": "..." }`
  - Response: `QuestionResponse` including generated `id`

- `GET /quiz/questions/?skip=0&limit=10` — List questions with their answers (auth required)
  - Query: `skip`, `limit`
  - Response: `List[QuestionResponse]`

Authorization header example:
```http
Authorization: Bearer <JWT>
```

Schemas (see `schemas.py`):
- `QuestionCreate`: `text`, optional `category`, `difficulty`
- `QuestionResponse`: `id`, fields from `QuestionCreate`, and `answers: List[AnswerResponse]`
- `AnswerResponse`: `id`, `text`, `is_correct`, `question_id`

### Quick Start (Local)
1) Prepare environment
```bash
python -m venv venv
venv\Scripts\activate  # Windows
# source venv/bin/activate  # Linux/Mac
pip install -r requirements.txt
```

2) Configure `.env` (see above) and ensure PostgreSQL is running and database exists.

3) Run server
```bash
uvicorn main:app --reload
```

4) Obtain token and call endpoints (via Swagger UI or cURL)

### Notes
- On first run, Tortoise will create tables automatically.
- For production, set a strong `SECRET_KEY` and consider migrations instead of auto-generate.
 - There is currently no public registration endpoint; create users via DB or a small management script.

### License
MIT (or your preferred license)


